<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAFIA NOIR</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root {
            --bg: #050507; --card: #121216; --accent: #ff3b30;
            --gold: #f1c40f; --text: #ffffff; --gray: #636366; --glass: rgba(255, 255, 255, 0.05);
        }
        body {
            margin: 0; background-color: var(--bg); color: var(--text);
            font-family: -apple-system, system-ui, sans-serif; overflow: hidden;
            background-image: radial-gradient(circle at 50% -20%, #1c1c24, #050507);
        }
        .screen { display: none; height: 100vh; flex-direction: column; padding: 24px; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Buttons */
        .btn { padding: 18px; border-radius: 16px; border: none; font-size: 16px; font-weight: 700; cursor: pointer; transition: 0.2s; text-transform: uppercase; margin-bottom: 12px; }
        .btn-primary { background: linear-gradient(135deg, #ff453a, #c62828); color: white; box-shadow: 0 5px 15px rgba(255, 59, 48, 0.3); }
        .btn-secondary { background: var(--glass); color: white; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .btn-gold { background: var(--gold); color: black; }

        /* Selector for players */
        .limit-selector { display: flex; justify-content: space-around; margin: 30px 0; gap: 10px; }
        .limit-btn { flex: 1; padding: 15px; background: var(--card); border: 1px solid #333; border-radius: 12px; color: white; font-weight: bold; }
        .limit-btn.selected { border-color: var(--accent); background: rgba(255, 59, 48, 0.1); color: var(--accent); }

        /* Radar */
        .radar-box { width: 120px; height: 120px; border: 2px solid var(--accent); border-radius: 50%; margin: 30px auto; position: relative; display: flex; justify-content: center; align-items: center; }
        .radar-box::after { content: ''; position: absolute; width: 100%; height: 100%; border: 2px solid var(--accent); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.6); opacity: 0; } }

        .room-code { font-size: 42px; font-weight: 900; color: var(--gold); letter-spacing: 10px; text-align: center; margin: 20px 0; text-shadow: 0 0 20px rgba(241, 196, 15, 0.3); }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div style="text-align: center; margin-top: 50px;">
            <h1 style="font-size: 48px; letter-spacing: 10px; color: var(--accent); margin: 0;">MAFIA</h1>
            <p style="color: var(--gray); letter-spacing: 3px; font-size: 10px;">DARK DISTRICT</p>
        </div>
        <div style="margin-top: auto; display: flex; flex-direction: column;">
            <button class="btn btn-primary" onclick="startOnline()">–ò–≥—Ä–∞—Ç—å –û–Ω–ª–∞–π–Ω</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-local-setup')">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-join')">–í–æ–π—Ç–∏ –ø–æ –∫–æ–¥—É</button>
            <button class="btn btn-gold" onclick="showScreen('screen-shop')">–ú–∞–≥–∞–∑–∏–Ω ‚≠ê</button>
        </div>
    </div>

    <div id="screen-local-setup" class="screen">
        <h2 style="text-align: center;">–ù–ê–°–¢–†–û–ô–ö–ê –ì–†–£–ü–ü–´</h2>
        <p style="color: var(--gray); text-align: center;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:</p>
        <div class="limit-selector">
            <button class="limit-btn" onclick="setLimit(this, 5)">5</button>
            <button class="limit-btn" onclick="setLimit(this, 7)">7</button>
            <button class="limit-btn selected" onclick="setLimit(this, 10)">10</button>
        </div>
        <button class="btn btn-primary" style="margin-top: auto;" onclick="createLocalRoom()">–°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏</button>
        <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-lobby" class="screen">
        <h2 style="text-align: center; margin: 0;">–í–ê–® –ö–û–î:</h2>
        <div class="room-code" id="display-code">----</div>
        <div class="radar-box">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        <p id="lobby-status" style="text-align: center; color: var(--gray);">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤: 1 / <span id="max-p">10</span></p>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="showScreen('screen-menu')">–ü–æ–∫–∏–Ω—É—Ç—å</button>
    </div>

    <div id="screen-join" class="screen">
        <h2 style="text-align: center;">–í–•–û–î –í –ò–ì–†–£</h2>
        <input type="number" id="join-input" placeholder="0000" style="width: 100%; background: var(--card); border: 1px solid #333; padding: 20px; border-radius: 15px; color: white; font-size: 32px; text-align: center; margin-top: 40px; outline: none;">
        <button class="btn btn-primary" style="margin-top: 40px;" onclick="joinWithCode()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="showScreen('screen-menu')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-shop" class="screen">
        <h2 style="text-align: center;">–ú–ê–ì–ê–ó–ò–ù ‚≠ê</h2>
        <div style="background: var(--card); padding: 20px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass);">
            <span>–ó–æ–ª–æ—Ç–æ–π –Ω–∏–∫</span>
            <button class="btn btn-gold" style="margin:0; padding: 10px 15px;">100 ‚≠ê</button>
        </div>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="showScreen('screen-menu')">–ù–∞–∑–∞–¥</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let currentLimit = 10;
        let socket;
        const SERVER_URL = "https://your-server.com"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –∞–¥—Ä–µ—Å

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        function setLimit(btn, num) {
            document.querySelectorAll('.limit-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            currentLimit = num;
        }

        function createLocalRoom() {
            showScreen('screen-lobby');
            document.getElementById('max-p').innerText = currentLimit;
            
            // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–¥ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            const randomCode = Math.floor(1000 + Math.random() * 9000);
            document.getElementById('display-code').innerText = randomCode;

            // –õ–æ–≥–∏–∫–∞ —Å–æ–∫–µ—Ç–∞ (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω)
            if (SERVER_URL.includes("your-server")) return; 
            
            socket = io(SERVER_URL);
            socket.emit('create_room', { limit: currentLimit, user: tg.initDataUnsafe.user });
            socket.on('room_id', (id) => { document.getElementById('display-code').innerText = id; });
        }

        function joinWithCode() {
            const code = document.getElementById('join-input').value;
            if(code.length < 4) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ 4 —Ü–∏—Ñ—Ä—ã –∫–æ–¥–∞!");
            
            tg.showConfirm(`–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ ${code}?`, (ok) => {
                if(ok) tg.showAlert("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...");
            });
        }

        function startOnline() {
            showScreen('screen-lobby');
            document.getElementById('display-code').innerText = "SEARCH";
            document.getElementById('lobby-status').innerText = "–ü–æ–∏—Å–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –º–∞—Ç—á–∞...";
        }
    </script>
</body>
</html>
