<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAFIA NOIR PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root {
            --bg: #050507; --card: #121216; --accent: #ff3b30;
            --gold: #f1c40f; --text: #ffffff; --gray: #636366; --glass: rgba(255, 255, 255, 0.05);
        }
        body {
            margin: 0; background-color: var(--bg); color: var(--text);
            font-family: -apple-system, system-ui, sans-serif; overflow: hidden;
            background-image: radial-gradient(circle at 50% -20%, #1c1c24, #050507);
        }
        .screen { display: none; height: 100vh; flex-direction: column; padding: 24px; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { padding: 18px; border-radius: 16px; border: none; font-size: 16px; font-weight: 700; cursor: pointer; transition: 0.2s; text-transform: uppercase; margin-bottom: 12px; width: 100%; }
        .btn-primary { background: linear-gradient(135deg, #ff453a, #c62828); color: white; box-shadow: 0 5px 15px rgba(255, 59, 48, 0.3); }
        .btn-secondary { background: var(--glass); color: white; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .btn-gold { background: var(--gold); color: black; box-shadow: 0 5px 15px rgba(241, 196, 15, 0.2); }

        /* –°–µ–ª–µ–∫—Ç–æ—Ä –∏–≥—Ä–æ–∫–æ–≤ */
        .limit-selector { display: flex; justify-content: space-around; margin: 30px 0; gap: 10px; }
        .limit-btn { flex: 1; padding: 15px; background: var(--card); border: 1px solid #333; border-radius: 12px; color: white; cursor: pointer; }
        .limit-btn.selected { border-color: var(--accent); background: rgba(255, 59, 48, 0.1); color: var(--accent); }

        /* –ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã */
        .room-code { font-size: 42px; font-weight: 900; color: var(--gold); letter-spacing: 10px; text-align: center; margin: 10px 0; cursor: pointer; text-shadow: 0 0 15px rgba(241, 196, 15, 0.4); }

        /* –†–∞–¥–∞—Ä */
        .radar-box { width: 100px; height: 100px; border: 2px solid var(--accent); border-radius: 50%; margin: 20px auto; position: relative; display: flex; justify-content: center; align-items: center; }
        .radar-box::after { content: ''; position: absolute; width: 100%; height: 100%; border: 2px solid var(--accent); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }

        /* –ß–∞—Ç */
        #chat-area { flex-grow: 1; background: var(--card); border-radius: 20px; padding: 15px; overflow-y: auto; margin-bottom: 15px; border: 1px solid var(--glass); }
        .shop-item { background: var(--card); padding: 20px; border-radius: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass); }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div style="text-align: center; margin-top: 40px;">
            <h1 style="font-size: 48px; letter-spacing: 10px; color: var(--accent); margin: 0;">MAFIA</h1>
            <p style="color: var(--gray); letter-spacing: 3px; font-size: 10px;">PREMIUM MOBILE</p>
        </div>
        <div style="margin-top: auto;">
            <button class="btn btn-primary" onclick="joinMode('online')">–ò–≥—Ä–∞—Ç—å –û–Ω–ª–∞–π–Ω</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-local-setup')">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-join-input')">–í–æ–π—Ç–∏ –ø–æ –∫–æ–¥—É</button>
            <button class="btn btn-gold" onclick="openShop()">–ú–∞–≥–∞–∑–∏–Ω ‚≠ê</button>
        </div>
    </div>

    <div id="screen-local-setup" class="screen">
        <h2 style="text-align: center;">–ù–ê–°–¢–†–û–ô–ö–ê</h2>
        <p style="color: var(--gray); text-align: center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</p>
        <div class="limit-selector">
            <button class="limit-btn" onclick="setPlayerLimit(this, 5)">5</button>
            <button class="limit-btn" onclick="setPlayerLimit(this, 7)">7</button>
            <button class="limit-btn selected" onclick="setPlayerLimit(this, 10)">10</button>
        </div>
        <button class="btn btn-primary" onclick="joinMode('local')">–ü–û–õ–£–ß–ò–¢–¨ –ö–û–î</button>
        <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-lobby" class="screen" style="text-align: center;">
        <div id="code-section">
            <p style="color: var(--gray); margin-bottom: 5px;">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</p>
            <div class="room-code" id="room-code-val" onclick="copyCode()">----</div>
            <p style="font-size: 10px; color: var(--accent);">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–¥, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</p>
        </div>
        <div class="radar-box">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        <h2 id="search-status">–û–ñ–ò–î–ê–ù–ò–ï...</h2>
        <p id="player-count">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ: 1 / 10</p>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="exitQueue()">–û–¢–ú–ï–ù–ê</button>
    </div>

    <div id="screen-shop" class="screen">
        <h2 style="text-align: center;">–ú–ê–ì–ê–ó–ò–ù ‚≠ê</h2>
        <div class="shop-item">
            <div>
                <div style="font-weight: bold;">–ó–æ–ª–æ—Ç–æ–π –Ω–∏–∫</div>
                <div style="font-size: 12px; color: var(--gray);">–í—ã–¥–µ–ª—è–π—Ç–µ—Å—å –≤ —á–∞—Ç–µ</div>
            </div>
            <button class="btn btn-gold" style="width: auto; padding: 10px 15px; margin: 0;" onclick="buy('Gold Nick')">100 ‚≠ê</button>
        </div>
        <div class="shop-item">
            <div>
                <div style="font-weight: bold;">–ö–∞—Ä—Ç–∞ –ú–∞—Ñ–∏–∏</div>
                <div style="font-size: 12px; color: var(--gray);">–®–∞–Ω—Å —Å—Ç–∞—Ç—å –º–∞—Ñ–∏–µ–π +50%</div>
            </div>
            <button class="btn btn-gold" style="width: auto; padding: 10px 15px; margin: 0;" onclick="buy('Mafia Card')">250 ‚≠ê</button>
        </div>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = "#050507";

        let selectedLimit = 10;
        let socket;

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        function setPlayerLimit(btn, num) {
            document.querySelectorAll('.limit-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedLimit = num;
            tg.HapticFeedback.impactOccurred('light');
        }

        function joinMode(mode) {
            showScreen('screen-lobby');
            const codeVal = document.getElementById('room-code-val');
            const status = document.getElementById('search-status');
            const pCount = document.getElementById('player-count');

            if (mode === 'local') {
                status.innerText = "–ì–†–£–ü–ü–ê –°–û–ó–î–ê–ù–ê";
                pCount.innerText = `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ: 1 / ${selectedLimit}`;
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–¥, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ—Ç
                codeVal.innerText = Math.floor(1000 + Math.random() * 9000);
            } else {
                status.innerText = "–ü–û–ò–°–ö –ò–ì–†–û–ö–û–í...";
                codeVal.innerText = "ONLINE";
                pCount.innerText = `–ù–∞–π–¥–µ–Ω–æ: 1 / 10`;
            }
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–æ–∫–µ—Ç—É, –∫–æ–≥–¥–∞ –ø—Ä–æ–ø–∏—à–µ—à—å SERVER_URL
        }

        function openShop() {
            showScreen('screen-shop');
        }

        function buy(item) {
            tg.showConfirm(`–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å ${item}?`, (ok) => {
                if (ok) tg.showAlert("–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Telegram Stars –±—É–¥–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –≤ –±–æ—Ç–µ.");
            });
        }

        function copyCode() {
            const code = document.getElementById('room-code-val').innerText;
            if (code === "ONLINE" || code === "----") return;
            
            // –°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª–æ–∫
            const el = document.createElement('textarea');
            el.value = code;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            tg.showAlert("–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã " + code + " —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –û—Ç–ø—Ä–∞–≤—å –µ–≥–æ –¥—Ä—É–∑—å—è–º.");
            tg.HapticFeedback.notificationOccurred('success');
        }

        function exitQueue() {
            showScreen('screen-menu');
        }
    </script>
</body>
</html>
