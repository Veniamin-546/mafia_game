<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAFIA NOIR: LEGACY</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root {
            --bg: #050507; --card: #121216; --accent: #ff3b30;
            --gold: #f1c40f; --text: #ffffff; --gray: #636366; --glass: rgba(255, 255, 255, 0.05);
        }
        body {
            margin: 0; background-color: var(--bg); color: var(--text);
            font-family: -apple-system, system-ui, sans-serif; overflow: hidden;
            background-image: radial-gradient(circle at 50% -20%, #1c1c24, #050507);
        }
        .screen { display: none; height: 100vh; flex-direction: column; padding: 24px; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Typography & Logo */
        .logo-area { text-align: center; margin-top: 20px; }
        .logo-area h1 { font-size: 42px; letter-spacing: 12px; color: var(--accent); margin: 0; text-shadow: 0 0 20px rgba(255,59,48,0.4); }
        
        /* Buttons */
        .btn { padding: 18px; border-radius: 16px; border: none; font-size: 15px; font-weight: 700; cursor: pointer; transition: 0.2s; text-transform: uppercase; margin-bottom: 12px; width: 100%; }
        .btn-primary { background: linear-gradient(135deg, #ff453a, #c62828); color: white; box-shadow: 0 5px 15px rgba(255, 59, 48, 0.3); }
        .btn-secondary { background: var(--glass); color: white; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .btn-gold { background: linear-gradient(135deg, #f1c40f, #d4ac0d); color: black; font-weight: 800; }

        /* Selector */
        .limit-selector { display: flex; justify-content: space-around; margin: 20px 0; gap: 8px; }
        .limit-btn { flex: 1; padding: 12px; background: var(--card); border: 1px solid #333; border-radius: 12px; color: white; cursor: pointer; }
        .limit-btn.selected { border-color: var(--accent); background: rgba(255, 59, 48, 0.1); color: var(--accent); }

        /* Lobby Info */
        .room-code { font-size: 48px; font-weight: 900; color: var(--gold); letter-spacing: 8px; text-align: center; margin: 10px 0; cursor: pointer; }
        .radar-box { width: 90px; height: 90px; border: 2px solid var(--accent); border-radius: 50%; margin: 20px auto; position: relative; display: flex; justify-content: center; align-items: center; }
        .radar-box::after { content: ''; position: absolute; width: 100%; height: 100%; border: 2px solid var(--accent); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }

        /* Shop Items */
        .shop-container { flex-grow: 1; overflow-y: auto; margin-bottom: 10px; padding-right: 5px; }
        .shop-item { background: var(--card); padding: 16px; border-radius: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass); }
        .shop-info b { display: block; font-size: 16px; margin-bottom: 4px; }
        .shop-info span { font-size: 11px; color: var(--gray); display: block; line-height: 1.3; }

        /* Game Interface */
        #chat-area { flex-grow: 1; background: var(--card); border-radius: 20px; padding: 15px; overflow-y: auto; margin-bottom: 10px; border: 1px solid var(--glass); }
        .msg { margin-bottom: 6px; font-size: 14px; }
        .msg.vip b { color: var(--gold); }
        .msg b { color: var(--accent); }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="logo-area">
            <h1>MAFIA</h1>
            <p style="color: var(--gray); font-size: 10px; letter-spacing: 4px;">MULTYPLAYER ONLINE</p>
        </div>
        <div style="margin-top: auto;">
            <button class="btn btn-primary" onclick="joinQueue('online')">–ë–´–°–¢–†–ê–Ø –ò–ì–†–ê</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-local-config')">–°–û–ó–î–ê–¢–¨ –ì–†–£–ü–ü–£</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-join-input')">–í–û–ô–¢–ò –ü–û –ö–û–î–£</button>
            <button class="btn btn-gold" onclick="showScreen('screen-shop')">–ú–ê–ì–ê–ó–ò–ù ‚≠ê</button>
        </div>
    </div>

    <div id="screen-local-config" class="screen">
        <h2 style="text-align: center;">–ù–ê–°–¢–†–û–ô–ö–ò</h2>
        <p style="color: var(--gray); text-align: center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏:</p>
        <div class="limit-selector">
            <button class="limit-btn" onclick="setLimit(this, 5)">5</button>
            <button class="limit-btn" onclick="setLimit(this, 7)">7</button>
            <button class="limit-btn selected" onclick="setLimit(this, 10)">10</button>
        </div>
        <button class="btn btn-primary" style="margin-top: auto;" onclick="joinQueue('local')">–°–û–ó–î–ê–¢–¨ –õ–û–ë–ë–ò</button>
        <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-join-input" class="screen">
        <h2 style="text-align: center;">–í–í–û–î –ö–û–î–ê</h2>
        <input type="number" id="room-input" placeholder="0000" style="width: 100%; background: var(--card); border: 1px solid #333; padding: 20px; border-radius: 15px; color: white; font-size: 32px; text-align: center; margin-top: 20px; outline: none;">
        <button class="btn btn-primary" style="margin-top: 30px;" onclick="joinWithCode()">–ü–†–ò–°–û–ï–î–ò–ù–ò–¢–¨–°–Ø</button>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-lobby" class="screen" style="text-align: center;">
        <div id="lobby-header-code">
            <p style="color: var(--gray); margin: 0;">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</p>
            <div class="room-code" id="lobby-code" onclick="copyCode()">----</div>
        </div>
        <div class="radar-box">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        <h3 id="lobby-status">–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï...</h3>
        <p id="lobby-count" style="color: var(--gray);">–ò–≥—Ä–æ–∫–∏: 1 / --</p>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="leaveLobby()">–í–´–ô–¢–ò</button>
    </div>

    <div id="screen-shop" class="screen">
        <h2 style="text-align: center;">–ú–ê–ì–ê–ó–ò–ù ‚≠ê</h2>
        <div class="shop-container">
            <div class="shop-item" style="border: 1px solid var(--gold);">
                <div class="shop-info">
                    <b style="color: var(--gold);">üëë VIP –°–¢–ê–¢–£–°</b>
                    <span>–ó–æ–ª–æ—Ç–æ–π –Ω–∏–∫, –∏–º–º—É–Ω–∏—Ç–µ—Ç –∫ –∫–∏–∫—É –∏<br>—É–Ω–∏–∫–∞–ª—å–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –≤ —á–∞—Ç–µ.</span>
                </div>
                <button class="btn-gold" style="width: auto; padding: 10px;" onclick="buy('VIP', 500)">500 ‚≠ê</button>
            </div>
            <div class="shop-item">
                <div class="shop-info">
                    <b>ü©∏ –®–ê–ù–° –ú–ê–§–ò–ò</b>
                    <span>–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å<br>–ú–∞—Ñ–∏–∏ –≤ 2 —Ä–∞–∑–∞ (–Ω–∞ 24 —á–∞—Å–∞).</span>
                </div>
                <button class="btn-gold" style="width: auto; padding: 10px;" onclick="buy('CHANCE_M', 150)">150 ‚≠ê</button>
            </div>
            <div class="shop-item">
                <div class="shop-info">
                    <b>üîç –®–ê–ù–° –®–ï–†–ò–§–ê</b>
                    <span>–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å<br>–ö–æ–º–∏—Å—Å–∞—Ä–∞ –≤ 2 —Ä–∞–∑–∞ (–Ω–∞ 24 —á–∞—Å–∞).</span>
                </div>
                <button class="btn-gold" style="width: auto; padding: 10px;" onclick="buy('CHANCE_S', 150)">150 ‚≠ê</button>
            </div>
        </div>
        <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-game" class="screen">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <b id="game-role" style="color:var(--gold)">–†–û–õ–¨: ???</b>
            <span style="color:var(--accent); font-size:12px;">–§–ê–ó–ê: –î–ï–ù–¨</span>
        </div>
        <div id="chat-area"></div>
        <div style="display:flex; gap:8px;">
            <input type="text" id="chat-msg" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1; padding:12px; border-radius:12px; background:#222; border:none; color:white;">
            <button class="btn-primary" style="width:50px; margin:0; border-radius:12px;" onclick="sendMessage()">üì°</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = "#050507";

        let socket;
        let selectedLimit = 10;
        const SERVER_URL = "https://your-server-address.com"; // –ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê –†–ï–ê–õ–¨–ù–´–ô URL

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        function setLimit(btn, num) {
            document.querySelectorAll('.limit-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedLimit = num;
        }

        function joinQueue(mode) {
            showScreen('screen-lobby');
            const codeDisp = document.getElementById('lobby-code');
            const statusDisp = document.getElementById('lobby-status');
            const countDisp = document.getElementById('lobby-count');

            if (mode === 'local') {
                statusDisp.innerText = "–ì–†–£–ü–ü–ê –°–û–ó–î–ê–ù–ê";
                countDisp.innerText = `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ: 1 / ${selectedLimit}`;
                codeDisp.innerText = Math.floor(1000 + Math.random() * 9000);
            } else {
                statusDisp.innerText = "–ü–û–ò–°–ö –ò–ì–†–û–ö–û–í...";
                codeDisp.innerText = "ONLINE";
                countDisp.innerText = "–ù–∞–π–¥–µ–Ω–æ: 1 / 10";
            }

            // –ò–º–∏—Ç–∞—Ü–∏—è —Å—Ç–∞—Ä—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ (–ø–æ–∫–∞ –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
            if(SERVER_URL.includes("your-server")) {
                setTimeout(() => {
                    if(mode === 'online') {
                        countDisp.innerText = "–ù–∞–π–¥–µ–Ω–æ: 10 / 10";
                        setTimeout(() => startGame("–ú–ê–§–ò–Ø ü©∏"), 1500);
                    }
                }, 2000);
            }
        }

        function joinWithCode() {
            const code = document.getElementById('room-input').value;
            if(code.length < 4) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥!");
            
            showScreen('screen-lobby');
            document.getElementById('lobby-code').innerText = code;
            document.getElementById('lobby-status').innerText = "–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ì–†–£–ü–ü–ï...";
        }

        function startGame(role) {
            showScreen('screen-game');
            document.getElementById('game-role').innerText = "–í–ê–®–ê –†–û–õ–¨: " + role;
            tg.HapticFeedback.notificationOccurred('success');
            appendMsg("–°–∏—Å—Ç–µ–º–∞", "–ì–æ—Ä–æ–¥ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è. –£ –≤–∞—Å –µ—Å—Ç—å 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ.");
        }

        function sendMessage() {
            const inp = document.getElementById('chat-msg');
            if(!inp.value) return;
            appendMsg(tg.initDataUnsafe.user?.first_name || "–í—ã", inp.value);
            inp.value = "";
            tg.HapticFeedback.impactOccurred('light');
        }

        function appendMsg(user, text) {
            const chat = document.getElementById('chat-area');
            const div = document.createElement('div');
            div.className = "msg";
            div.innerHTML = `<b>${user}:</b> ${text}`;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function buy(item, price) {
            tg.showConfirm(`–ö—É–ø–∏—Ç—å ${item} –∑–∞ ${price} Stars?`, (ok) => {
                if(ok) tg.showAlert("–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç–æ–º –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.");
            });
        }

        function copyCode() {
            const code = document.getElementById('lobby-code').innerText;
            if(code === "ONLINE" || code === "----") return;
            
            const area = document.createElement('textarea');
            area.value = code;
            document.body.appendChild(area);
            area.select();
            document.execCommand('copy');
            document.body.removeChild(area);
            
            tg.showAlert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –û—Ç–ø—Ä–∞–≤—å –µ–≥–æ –¥—Ä—É–∑—å—è–º.");
            tg.HapticFeedback.notificationOccurred('success');
        }

        function leaveLobby() {
            showScreen('screen-menu');
        }
    </script>
</body>
</html>
