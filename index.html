<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mafia Noir - Local & Online</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root {
            --bg: #0a0a0c; --card: #16161a; --accent: #ff3b30;
            --gold: #f1c40f; --text: #ffffff; --gray: #8e8e93;
        }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; overflow: hidden; }
        
        .screen { display: none; height: 100vh; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .menu-grid { display: grid; gap: 12px; width: 100%; max-width: 300px; margin: auto; }
        button { padding: 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .btn-red { background: var(--accent); color: white; }
        .btn-dark { background: var(--card); color: white; border: 1px solid #333; }
        
        /* –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–æ–≤ */
        .selector { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .num-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--card); border: 1px solid #444; color: white; }
        .num-btn.selected { background: var(--accent); border-color: var(--accent); }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–¥–∞ */
        .code-input { 
            background: #24242b; border: 2px solid #3a3a42; border-radius: 12px;
            padding: 15px; color: white; font-size: 24px; text-align: center; 
            letter-spacing: 10px; width: 80%; margin: 20px auto; outline: none;
        }
        
        #chat-area { flex-grow: 1; background: var(--card); border-radius: 15px; padding: 15px; overflow-y: auto; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <h1 style="text-align:center; color: var(--accent); letter-spacing: 5px;">MAFIA</h1>
        <div class="menu-grid">
            <button class="btn-red" onclick="startSearch()">–ò–ì–†–ê–¢–¨ –û–ù–õ–ê–ô–ù</button>
            <button class="btn-dark" onclick="showScreen('screen-local-menu')">–õ–û–ö–ê–õ–¨–ù–ê–Ø –ì–†–£–ü–ü–ê</button>
            <button class="btn-dark" style="color: var(--gold)" onclick="showScreen('screen-shop')">–ú–ê–ì–ê–ó–ò–ù ‚≠ê</button>
        </div>
    </div>

    <div id="screen-local-menu" class="screen">
        <h2>–õ–æ–∫–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞</h2>
        <button class="btn-red" onclick="showScreen('screen-create')">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
        <p style="text-align:center; color: var(--gray)">–∏–ª–∏</p>
        <button class="btn-dark" onclick="showScreen('screen-join')">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –ø–æ –∫–æ–¥—É</button>
        <button class="btn-dark" style="margin-top:auto" onclick="showScreen('screen-menu')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-create" class="screen">
        <h3>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</h3>
        <div class="selector">
            <button class="num-btn" onclick="selectPlayers(this, 5)">5</button>
            <button class="num-btn" onclick="selectPlayers(this, 7)">7</button>
            <button class="num-btn selected" onclick="selectPlayers(this, 10)">10</button>
        </div>
        <button class="btn-red" onclick="createRoom()">–°–û–ó–î–ê–¢–¨ –ò –ü–û–õ–£–ß–ò–¢–¨ –ö–û–î</button>
        <button class="btn-dark" style="margin-top:20px" onclick="showScreen('screen-local-menu')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-join" class="screen">
        <h3>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã</h3>
        <input type="text" class="code-input" id="room-code-input" maxlength="4" placeholder="0000">
        <button class="btn-red" onclick="joinByCode()">–í–û–ô–¢–ò</button>
        <button class="btn-dark" style="margin-top:20px" onclick="showScreen('screen-local-menu')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-loading" class="screen" style="align-items:center; justify-content:center;">
        <div id="room-id-display" style="font-size: 24px; color: var(--gold); margin-bottom: 20px;"></div>
        <div style="width:100px; height:100px; border:3px solid var(--accent); border-radius:50%; animation: pulse 2s infinite;"></div>
        <p id="player-count">–û–∂–∏–¥–∞–Ω–∏–µ: 1 / 10</p>
        <button class="btn-dark" onclick="location.reload()">–û—Ç–º–µ–Ω–∞</button>
    </div>

    <div id="screen-game" class="screen">
        <div id="chat-area"></div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="chat-input" style="flex:1; padding:12px; border-radius:10px; border:none; background:#222; color:white;">
            <button class="btn-red" onclick="send()">üì°</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let selectedCount = 10;
        let socket; 
        const SERVER_URL = "https://your-server.com"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π URL

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        function selectPlayers(btn, num) {
            document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedCount = num;
        }

        function createRoom() {
            showScreen('screen-loading');
            document.getElementById('player-count').innerText = `–û–∂–∏–¥–∞–Ω–∏–µ: 1 / ${selectedCount}`;
            
            // –õ–æ–≥–∏–∫–∞ —Å–æ–∫–µ—Ç–∞
            socket = io(SERVER_URL);
            socket.emit('create_room', { maxPlayers: selectedCount, user: tg.initDataUnsafe.user });
            
            socket.on('room_created', (code) => {
                document.getElementById('room-id-display').innerText = `–ö–û–î: ${code}`;
            });
        }

        function joinByCode() {
            const code = document.getElementById('room-code-input').value;
            if(code.length < 4) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ 4 –∑–Ω–∞–∫–∞");
            
            showScreen('screen-loading');
            socket = io(SERVER_URL);
            socket.emit('join_room', { code: code, user: tg.initDataUnsafe.user });
        }

        // –°–ª—É—à–∞—Ç–µ–ª—å —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã
        // socket.on('game_start', (data) => { showScreen('screen-game'); ... });

    </script>
</body>
</html>
