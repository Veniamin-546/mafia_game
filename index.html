<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mafia Noir Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root {
            --bg: #0a0a0c; --card: #16161a; --accent: #ff3b30;
            --gold: #f1c40f; --text: #ffffff; --gray: #8e8e93;
        }
        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: -apple-system, system-ui, sans-serif; overflow: hidden; 
        }
        
        .screen { display: none; height: 100vh; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        .logo-box { text-align: center; margin-top: 40px; }
        .logo-box h1 { font-size: 50px; color: var(--accent); letter-spacing: 10px; margin: 0; }
        
        .menu-grid { display: grid; gap: 15px; width: 100%; max-width: 320px; margin: auto; }
        button { 
            padding: 18px; border-radius: 16px; border: none; font-weight: bold; 
            font-size: 16px; cursor: pointer; transition: 0.2s; 
        }
        button:active { transform: scale(0.96); opacity: 0.8; }
        
        .btn-main { background: var(--accent); color: white; box-shadow: 0 4px 15px rgba(255, 59, 48, 0.3); }
        .btn-dark { background: var(--card); color: white; border: 1px solid #2c2c2e; }
        .btn-gold { background: var(--gold); color: black; }

        /* –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–æ–≤ */
        .selector { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .num-btn { width: 50px; height: 50px; border-radius: 12px; background: var(--card); color: white; border: 1px solid #333; }
        .num-btn.selected { background: var(--accent); border-color: var(--accent); }

        /* –†–∞–¥–∞—Ä –∏ –∑–∞–≥—Ä—É–∑–∫–∞ */
        .radar-box {
            width: 150px; height: 150px; border: 2px solid var(--accent);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            position: relative; margin: 40px auto;
        }
        .radar-box::after {
            content: ''; position: absolute; width: 100%; height: 100%;
            border: 2px solid var(--accent); border-radius: 50%; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.6); opacity: 0; } }

        .code-display { font-size: 32px; color: var(--gold); font-weight: bold; letter-spacing: 5px; text-align: center; }

        /* –ß–∞—Ç */
        #chat-area { flex-grow: 1; background: var(--card); border-radius: 20px; padding: 15px; overflow-y: auto; margin-bottom: 15px; border: 1px solid #2c2c2e; }
        .msg { margin-bottom: 8px; font-size: 14px; }
        .msg b { color: var(--accent); }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div class="logo-box">
            <h1>MAFIA</h1>
            <p style="color: var(--gray)">PREMIUM EDITION</p>
        </div>
        <div class="menu-grid">
            <button class="btn-main" onclick="startOnline()">–ò–ì–†–ê–¢–¨ –û–ù–õ–ê–ô–ù</button>
            <button class="btn-dark" onclick="showScreen('screen-local-config')">–°–û–ó–î–ê–¢–¨ –ì–†–£–ü–ü–£</button>
            <button class="btn-dark" onclick="showScreen('screen-join-code')">–í–û–ô–¢–ò –ü–û –ö–û–î–£</button>
            <button class="btn-gold" onclick="showScreen('screen-shop')">–ú–ê–ì–ê–ó–ò–ù ‚≠ê</button>
        </div>
    </div>

    <div id="screen-local-config" class="screen">
        <h2>–ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞</h2>
        <p style="color: var(--gray)">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</p>
        <div class="selector">
            <button class="num-btn" onclick="setLimit(this, 5)">5</button>
            <button class="num-btn" onclick="setLimit(this, 7)">7</button>
            <button class="num-btn selected" onclick="setLimit(this, 10)">10</button>
        </div>
        <button class="btn-main" onclick="createLocalRoom()">–ü–û–õ–£–ß–ò–¢–¨ –ö–û–î</button>
        <button class="btn-dark" style="margin-top: 15px;" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-join-code" class="screen">
        <h2>–í—Ö–æ–¥ –≤ –≥—Ä—É–ø–ø—É</h2>
        <input type="number" id="join-input" placeholder="0000" 
               style="width: 100%; padding: 20px; border-radius: 15px; background: #222; border: 1px solid #444; color: white; font-size: 24px; text-align: center; margin: 40px 0;">
        <button class="btn-main" style="width: 100%;" onclick="joinRoom()">–ü–†–ò–°–û–ï–î–ò–ù–ò–¢–¨–°–Ø</button>
        <button class="btn-dark" style="width: 100%; margin-top: 15px;" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-loading" class="screen" style="text-align: center;">
        <div id="room-code-area" style="display: none;">
            <p style="color: var(--gray)">–ö–æ–¥ –≤–∞—à–µ–π –∫–æ–º–Ω–∞—Ç—ã:</p>
            <div class="code-display" id="display-code">----</div>
        </div>
        <div class="radar-box">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        <h3 id="loading-status">–ü–û–ò–°–ö –ò–ì–†–û–ö–û–í...</h3>
        <p id="player-count" style="color: var(--gray)">–ù–∞–π–¥–µ–Ω–æ: 1 / 10</p>
        <button class="btn-dark" style="margin-top: auto;" onclick="cancelAll()">–û–¢–ú–ï–ù–ê</button>
    </div>

    <div id="screen-game" class="screen">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span id="role-box" style="color: var(--gold); font-weight: bold;">–†–û–õ–¨: ???</span>
            <span style="font-size: 12px; opacity: 0.5;">–§–ê–ó–ê: –î–ï–ù–¨</span>
        </div>
        <div id="chat-area"></div>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="chat-in" placeholder="–û–±—Å—É–∂–¥–µ–Ω–∏–µ..." style="flex: 1; padding: 15px; border-radius: 12px; border: none; background: #222; color: white;">
            <button class="btn-main" onclick="sendMsg()">üì°</button>
        </div>
    </div>

    <div id="screen-shop" class="screen">
        <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
        <div style="background: var(--card); padding: 20px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center;">
            <span>–ó–æ–ª–æ—Ç–æ–π –Ω–∏–∫</span>
            <button class="btn-gold" onclick="tg.showAlert('–ü–ª–∞—Ç–µ–∂ Stars –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">100 ‚≠ê</button>
        </div>
        <button class="btn-dark" style="margin-top: auto;" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let socket;
        let selectedLimit = 10;
        let searchInterval;
        const SERVER_URL = "https://your-real-server.com"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        function setLimit(btn, num) {
            document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedLimit = num;
        }

        // --- –õ–û–ì–ò–ö–ê –û–ù–õ–ê–ô–ù ---
        function startOnline() {
            showScreen('screen-loading');
            document.getElementById('room-code-area').style.display = 'none';
            document.getElementById('loading-status').innerText = "–ü–û–ò–°–ö –ò–ì–†–û–ö–û–í...";
            
            let found = 1;
            // –ò–º–∏—Ç–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞ (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)
            searchInterval = setInterval(() => {
                found++;
                document.getElementById('player-count').innerText = `–ù–∞–π–¥–µ–Ω–æ: ${found} / 10`;
                if(found >= 10) {
                    clearInterval(searchInterval);
                    startGame("–ú–∏—Ä–Ω—ã–π –∂–∏—Ç–µ–ª—å");
                }
            }, 1000);
        }

        // --- –õ–û–ì–ò–ö–ê –ì–†–£–ü–ü–´ ---
        function createLocalRoom() {
            showScreen('screen-loading');
            document.getElementById('room-code-area').style.display = 'block';
            document.getElementById('loading-status').innerText = "–û–ñ–ò–î–ê–ù–ò–ï –î–†–£–ó–ï–ô...";
            document.getElementById('player-count').innerText = `–í –≥—Ä—É–ø–ø–µ: 1 / ${selectedLimit}`;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤–∏–¥–∞ (–ø–æ–∫–∞ –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
            const fakeCode = Math.floor(1000 + Math.random() * 9000);
            document.getElementById('display-code').innerText = fakeCode;
        }

        function joinRoom() {
            const code = document.getElementById('join-input').value;
            if(code.length < 4) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥!");
            
            showScreen('screen-loading');
            document.getElementById('loading-status').innerText = "–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï...";
            setTimeout(() => startGame("–ú–∞—Ñ–∏—è"), 1500); // –ò–º–∏—Ç–∞—Ü–∏—è –≤—Ö–æ–¥–∞
        }

        function startGame(role) {
            showScreen('screen-game');
            document.getElementById('role-box').innerText = `–†–û–õ–¨: ${role}`;
            tg.HapticFeedback.notificationOccurred('success');
            appendMsg("–°–∏—Å—Ç–µ–º–∞", "–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ì–æ—Ä–æ–¥ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è.");
        }

        function sendMsg() {
            const inp = document.getElementById('chat-in');
            if(!inp.value) return;
            appendMsg(tg.initDataUnsafe.user?.first_name || "–ò–≥—Ä–æ–∫", inp.value);
            inp.value = "";
        }

        function appendMsg(user, text) {
            const chat = document.getElementById('chat-area');
            chat.innerHTML += `<div class="msg"><b>${user}:</b> ${text}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }

        function cancelAll() {
            clearInterval(searchInterval);
            showScreen('screen-menu');
        }
    </script>
</body>
</html>
