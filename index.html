<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAFIA NOIR ULTIMATE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root {
            --bg: #050507; --card: #121216; --accent: #ff3b30;
            --gold: #f1c40f; --text: #ffffff; --gray: #636366; --glass: rgba(255, 255, 255, 0.05);
        }
        body {
            margin: 0; background-color: var(--bg); color: var(--text);
            font-family: -apple-system, system-ui, sans-serif; overflow: hidden;
            background-image: radial-gradient(circle at 50% -20%, #1c1c24, #050507);
        }
        .screen { display: none; height: 100vh; flex-direction: column; padding: 24px; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Buttons */
        .btn { padding: 18px; border-radius: 16px; border: none; font-size: 16px; font-weight: 700; cursor: pointer; transition: 0.2s; text-transform: uppercase; margin-bottom: 12px; width: 100%; }
        .btn-primary { background: linear-gradient(135deg, #ff453a, #c62828); color: white; box-shadow: 0 5px 15px rgba(255, 59, 48, 0.3); }
        .btn-secondary { background: var(--glass); color: white; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .btn-gold { background: var(--gold); color: black; box-shadow: 0 5px 15px rgba(241, 196, 15, 0.2); }

        /* Selector */
        .limit-selector { display: flex; justify-content: space-around; margin: 30px 0; gap: 10px; }
        .limit-btn { flex: 1; padding: 15px; background: var(--card); border: 1px solid #333; border-radius: 12px; color: white; cursor: pointer; }
        .limit-btn.selected { border-color: var(--accent); background: rgba(255, 59, 48, 0.1); color: var(--accent); }

        /* Code Display */
        .room-code { font-size: 42px; font-weight: 900; color: var(--gold); letter-spacing: 10px; text-align: center; margin: 10px 0; cursor: pointer; text-shadow: 0 0 15px rgba(241, 196, 15, 0.4); }
        
        /* Input */
        .code-input { width: 100%; background: var(--card); border: 1px solid #333; padding: 20px; border-radius: 15px; color: white; font-size: 32px; text-align: center; margin-top: 40px; outline: none; transition: 0.3s; }
        .code-input:focus { border-color: var(--accent); }

        /* Radar */
        .radar-box { width: 100px; height: 100px; border: 2px solid var(--accent); border-radius: 50%; margin: 20px auto; position: relative; display: flex; justify-content: center; align-items: center; }
        .radar-box::after { content: ''; position: absolute; width: 100%; height: 100%; border: 2px solid var(--accent); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }

        /* Shop */
        .shop-item { background: var(--card); padding: 20px; border-radius: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass); }
    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <div style="text-align: center; margin-top: 40px;">
            <h1 style="font-size: 48px; letter-spacing: 10px; color: var(--accent); margin: 0;">MAFIA</h1>
            <p style="color: var(--gray); letter-spacing: 3px; font-size: 10px;">PREMIUM EDITION</p>
        </div>
        <div style="margin-top: auto;">
            <button class="btn btn-primary" onclick="joinMode('online')">–ò–≥—Ä–∞—Ç—å –û–Ω–ª–∞–π–Ω</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-local-setup')">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
            <button class="btn btn-secondary" onclick="showScreen('screen-join-input')">–í–æ–π—Ç–∏ –ø–æ –∫–æ–¥—É</button>
            <button class="btn btn-gold" onclick="showScreen('screen-shop')">–ú–∞–≥–∞–∑–∏–Ω ‚≠ê</button>
        </div>
    </div>

    <div id="screen-local-setup" class="screen">
        <h2 style="text-align: center;">–ù–ê–°–¢–†–û–ô–ö–ê</h2>
        <div class="limit-selector">
            <button class="limit-btn" onclick="setLimit(this, 5)">5</button>
            <button class="limit-btn" onclick="setLimit(this, 7)">7</button>
            <button class="limit-btn selected" onclick="setLimit(this, 10)">10</button>
        </div>
        <button class="btn btn-primary" onclick="joinMode('create')">–ü–û–õ–£–ß–ò–¢–¨ –ö–û–î</button>
        <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-join-input" class="screen">
        <h2 style="text-align: center;">–í–•–û–î –í –õ–û–ë–ë–ò</h2>
        <input type="number" id="input-room-code" class="code-input" placeholder="0000">
        <button class="btn btn-primary" style="margin-top: 40px;" onclick="joinByCode()">–ü–†–ò–°–û–ï–î–ò–ù–ò–¢–¨–°–Ø</button>
        <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-lobby" class="screen" style="text-align: center;">
        <p style="color: var(--gray); margin-bottom: 5px;" id="lobby-type-text">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</p>
        <div class="room-code" id="lobby-code-display" onclick="copyCode()">----</div>
        <div class="radar-box">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        <h2 id="lobby-status">–û–ñ–ò–î–ê–ù–ò–ï...</h2>
        <p id="lobby-count">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ: 1 / 10</p>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="showScreen('screen-menu')">–í–´–ô–¢–ò</button>
    </div>

    <div id="screen-shop" class="screen">
        <h2 style="text-align: center;">–ú–ê–ì–ê–ó–ò–ù ‚≠ê</h2>
        <div class="shop-item">
            <div><b>–ó–æ–ª–æ—Ç–æ–π –Ω–∏–∫</b><div style="font-size:12px; color:var(--gray)">–í—ã–¥–µ–ª—è–π—Ç–µ—Å—å –≤ —á–∞—Ç–µ</div></div>
            <button class="btn-gold" style="width:auto; padding:10px" onclick="tg.showAlert('–û–ø–ª–∞—Ç–∞ Stars –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è')">100 ‚≠ê</button>
        </div>
        <button class="btn btn-secondary" style="margin-top: auto;" onclick="showScreen('screen-menu')">–ù–ê–ó–ê–î</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let selectedLimit = 10;

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        function setLimit(btn, num) {
            document.querySelectorAll('.limit-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedLimit = num;
        }

        function joinMode(mode) {
            const codeDisplay = document.getElementById('lobby-code-display');
            const status = document.getElementById('lobby-status');
            const count = document.getElementById('lobby-count');
            
            showScreen('screen-lobby');

            if (mode === 'create') {
                const newCode = Math.floor(1000 + Math.random() * 9000);
                codeDisplay.innerText = newCode;
                status.innerText = "–ì–†–£–ü–ü–ê –°–û–ó–î–ê–ù–ê";
                count.innerText = `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ: 1 / ${selectedLimit}`;
            } else if (mode === 'online') {
                codeDisplay.innerText = "ONLINE";
                status.innerText = "–ü–û–ò–°–ö –ú–ê–¢–ß–ê...";
                count.innerText = "–ù–∞–π–¥–µ–Ω–æ: 1 / 10";
            }
        }

        function joinByCode() {
            const codeInput = document.getElementById('input-room-code').value;
            if (codeInput.length < 4) {
                tg.showAlert("–í–≤–µ–¥–∏—Ç–µ 4-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã!");
                return;
            }

            const codeDisplay = document.getElementById('lobby-code-display');
            const status = document.getElementById('lobby-status');
            const count = document.getElementById('lobby-count');

            showScreen('screen-lobby');
            codeDisplay.innerText = codeInput;
            status.innerText = "–ü–û–î–ö–õ–Æ–ß–ï–ù–û –ö –õ–û–ë–ë–ò";
            count.innerText = "–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞...";
        }

        function copyCode() {
            const code = document.getElementById('lobby-code-display').innerText;
            if (code === "----" || code === "ONLINE") return;
            
            const el = document.createElement('textarea');
            el.value = code;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            tg.showAlert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: " + code);
            tg.HapticFeedback.notificationOccurred('success');
        }
    </script>
</body>
</html>
